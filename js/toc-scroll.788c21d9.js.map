{"version":3,"file":"js/toc-scroll.788c21d9.js","mappings":"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","sources":["webpack://hexo-theme-papermod/./source-src/js/toc-scroll.js"],"sourcesContent":["// TOC Scroll Synchronization\n(function() {\n  'use strict';\n\n  // Configuration\n  const CONFIG = {\n    tocSelector: '.toc-content',\n    linkSelector: '.toc-content a',\n    headingSelector: '.post-content h1, .post-content h2, .post-content h3, .post-content h4, .post-content h5, .post-content h6',\n    activeClass: 'active',\n    offset: 100, // Offset from top (header height + buffer)\n    throttleDelay: 100 // Throttle scroll events\n  };\n\n  let headings = [];\n  let tocLinks = [];\n  let currentActiveIndex = -1;\n\n  /**\n   * Initialize TOC scroll synchronization\n   */\n  function init() {\n    const tocContent = document.querySelector(CONFIG.tocSelector);\n    if (!tocContent) return;\n\n    // Collect all headings and their corresponding TOC links\n    headings = Array.from(document.querySelectorAll(CONFIG.headingSelector))\n      .filter(heading => heading.id) // Only headings with IDs\n      .map(heading => ({\n        id: heading.id,\n        element: heading,\n        top: 0 // Will be updated on scroll\n      }));\n\n    if (headings.length === 0) return;\n\n    // Collect TOC links\n    tocLinks = Array.from(document.querySelectorAll(CONFIG.linkSelector))\n      .map(link => {\n        const href = link.getAttribute('href');\n        const id = href ? href.substring(1) : null;\n        return {\n          element: link,\n          id: id,\n          listItem: link.closest('li')\n        };\n      })\n      .filter(link => link.id);\n\n    // Initialize scroll listener\n    window.addEventListener('scroll', throttle(updateActiveSection, CONFIG.throttleDelay));\n    window.addEventListener('resize', throttle(updateActiveSection, CONFIG.throttleDelay));\n\n    // Initial update\n    updateActiveSection();\n\n    // Initialize mobile behavior\n    initMobileTocBehavior();\n  }\n\n  /**\n   * Update active section based on scroll position\n   */\n  function updateActiveSection() {\n    // Update heading positions\n    headings.forEach(heading => {\n      heading.top = heading.element.getBoundingClientRect().top + window.pageYOffset;\n    });\n\n    // Find the current active heading\n    const scrollPosition = window.pageYOffset + CONFIG.offset;\n\n    let activeIndex = -1;\n\n    // Find the last heading that is above the scroll position\n    for (let i = headings.length - 1; i >= 0; i--) {\n      if (scrollPosition >= headings[i].top) {\n        activeIndex = i;\n        break;\n      }\n    }\n\n    // If we're near the top, activate first heading\n    if (scrollPosition < headings[0].top && scrollPosition > headings[0].top - 200) {\n      activeIndex = 0;\n    }\n\n    // Only update if active section changed\n    if (activeIndex !== currentActiveIndex) {\n      setActiveSection(activeIndex);\n      currentActiveIndex = activeIndex;\n    }\n  }\n\n  /**\n   * Set active section in TOC\n   */\n  function setActiveSection(index) {\n    // Remove all active classes\n    tocLinks.forEach(link => {\n      if (link.listItem) {\n        link.listItem.classList.remove(CONFIG.activeClass);\n      }\n    });\n\n    // Add active class to current section\n    if (index >= 0 && index < headings.length) {\n      const activeId = headings[index].id;\n      const activeTocLink = tocLinks.find(link => link.id === activeId);\n\n      if (activeTocLink && activeTocLink.listItem) {\n        activeTocLink.listItem.classList.add(CONFIG.activeClass);\n\n        // Scroll TOC to make active item visible\n        scrollTocToActiveItem(activeTocLink.element);\n      }\n    }\n  }\n\n  /**\n   * Scroll TOC sidebar to make active item visible\n   */\n  function scrollTocToActiveItem(element) {\n    const sidebar = element.closest('.post-sidebar');\n    if (!sidebar) return;\n\n    const sidebarRect = sidebar.getBoundingClientRect();\n    const elementRect = element.getBoundingClientRect();\n\n    // Check if element is outside visible area\n    if (elementRect.top < sidebarRect.top || elementRect.bottom > sidebarRect.bottom) {\n      element.scrollIntoView({\n        behavior: 'smooth',\n        block: 'nearest'\n      });\n    }\n  }\n\n  /**\n   * Throttle function to limit scroll event frequency\n   */\n  function throttle(func, delay) {\n    let timeoutId;\n    let lastExecTime = 0;\n\n    return function(...args) {\n      const currentTime = Date.now();\n\n      if (currentTime - lastExecTime < delay) {\n        clearTimeout(timeoutId);\n        timeoutId = setTimeout(() => {\n          lastExecTime = currentTime;\n          func.apply(this, args);\n        }, delay);\n      } else {\n        lastExecTime = currentTime;\n        func.apply(this, args);\n      }\n    };\n  }\n\n  /**\n   * TOC Toggle functionality\n   */\n  function initTocToggle() {\n    const tocToggle = document.querySelector('.toc-toggle');\n    const tocContainer = document.querySelector('.toc-container');\n\n    if (!tocToggle || !tocContainer) return;\n\n    tocToggle.addEventListener('click', () => {\n      tocContainer.classList.toggle('toc-open');\n\n      // Save state to localStorage\n      const isOpen = tocContainer.classList.contains('toc-open');\n      localStorage.setItem('tocOpen', isOpen ? 'true' : 'false');\n\n      // Update ARIA\n      tocToggle.setAttribute('aria-expanded', isOpen ? 'true' : 'false');\n    });\n\n    // Restore state from localStorage\n    const savedState = localStorage.getItem('tocOpen');\n    if (savedState === 'true') {\n      tocContainer.classList.add('toc-open');\n      tocToggle.setAttribute('aria-expanded', 'true');\n    } else if (savedState === 'false') {\n      tocContainer.classList.remove('toc-open');\n      tocToggle.setAttribute('aria-expanded', 'false');\n    }\n  }\n\n  /**\n   * Detect mobile view\n   */\n  function isMobileView() {\n    return window.innerWidth <= 768;\n  }\n\n  /**\n   * Auto-close TOC on mobile after clicking a link\n   */\n  function initMobileTocBehavior() {\n    if (!isMobileView()) return;\n\n    const tocLinks = document.querySelectorAll('.toc-content a');\n    const tocContainer = document.querySelector('.toc-container');\n\n    tocLinks.forEach(link => {\n      link.addEventListener('click', () => {\n        if (isMobileView() && tocContainer) {\n          // Close TOC after short delay\n          setTimeout(() => {\n            tocContainer.classList.remove('toc-open');\n            const tocToggle = tocContainer.querySelector('.toc-toggle');\n            if (tocToggle) {\n              tocToggle.setAttribute('aria-expanded', 'false');\n            }\n          }, 300);\n        }\n      });\n    });\n  }\n\n  /**\n   * Keyboard navigation for TOC links\n   */\n  function initKeyboardNav() {\n    const tocLinks = document.querySelectorAll('.toc-content a');\n\n    tocLinks.forEach((link, index) => {\n      link.addEventListener('keydown', (e) => {\n        let targetIndex = -1;\n\n        switch(e.key) {\n          case 'ArrowDown':\n            e.preventDefault();\n            targetIndex = index + 1;\n            break;\n          case 'ArrowUp':\n            e.preventDefault();\n            targetIndex = index - 1;\n            break;\n          case 'Home':\n            e.preventDefault();\n            targetIndex = 0;\n            break;\n          case 'End':\n            e.preventDefault();\n            targetIndex = tocLinks.length - 1;\n            break;\n        }\n\n        if (targetIndex >= 0 && targetIndex < tocLinks.length) {\n          tocLinks[targetIndex].focus();\n        }\n      });\n    });\n  }\n\n  // Initialize when DOM is ready\n  if (document.readyState === 'loading') {\n    document.addEventListener('DOMContentLoaded', () => {\n      init();\n      initTocToggle();\n      initKeyboardNav();\n    });\n  } else {\n    init();\n    initTocToggle();\n    initKeyboardNav();\n  }\n})();\n"],"names":["CONFIG","headings","tocLinks","currentActiveIndex","init","document","querySelector","Array","from","querySelectorAll","filter","heading","id","map","element","top","length","link","href","getAttribute","substring","listItem","closest","window","addEventListener","throttle","updateActiveSection","isMobileView","tocContainer","forEach","setTimeout","classList","remove","tocToggle","setAttribute","initMobileTocBehavior","getBoundingClientRect","pageYOffset","scrollPosition","activeIndex","i","index","activeId","activeTocLink","find","add","sidebar","sidebarRect","elementRect","bottom","scrollIntoView","behavior","block","scrollTocToActiveItem","setActiveSection","func","delay","timeoutId","lastExecTime","_this","_len","arguments","args","_key","currentTime","Date","now","clearTimeout","apply","this","initTocToggle","toggle","isOpen","contains","localStorage","setItem","savedState","getItem","innerWidth","initKeyboardNav","e","targetIndex","key","preventDefault","focus","readyState"],"ignoreList":[],"sourceRoot":""}